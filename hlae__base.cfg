// tekno™®© 2022

// ------------------ recording ----------------- //

// reset old settings
mirv_streams preview ""
mirv_streams remove game
mirv_streams remove blur
mirv_streams remove hud_black
mirv_streams remove hud_white
mirv_streams remove viewmodel
mirv_streams settings remove tekno_blur
mirv_streams settings remove tekno_ffmpeg_terrible
mirv_streams settings remove tekno_ffmpeg_low
mirv_streams settings remove tekno_ffmpeg_medium
mirv_streams settings remove tekno_ffmpeg_high
mirv_streams settings remove tekno_ffmpeg_ultra_high
mirv_streams settings remove tekno_ffmpeg_almost_lossless
mirv_streams settings remove tekno_ffmpeg_lossless
mirv_streams settings remove tekno_ffmpeg_prores
mirv_streams settings remove tekno_ffmpeg_utvideo


// set up ffmpeg recording configs
mirv_streams settings add ffmpeg tekno_ffmpeg_terrible "-c:v libx264 -pix_fmt yuv420p -preset ultrafast -crf 30 {QUOTE}{AFX_STREAM_PATH}\video.mp4{QUOTE}"
mirv_streams settings add ffmpeg tekno_ffmpeg_low "-c:v libx264 -pix_fmt yuv420p -preset ultrafast -crf 21 {QUOTE}{AFX_STREAM_PATH}\video.mp4{QUOTE}"
mirv_streams settings add ffmpeg tekno_ffmpeg_medium "-c:v libx264 -pix_fmt yuv420p -preset ultrafast -crf 18 {QUOTE}{AFX_STREAM_PATH}\video.mp4{QUOTE}"
mirv_streams settings add ffmpeg tekno_ffmpeg_high "-c:v libx264 -pix_fmt yuv420p -preset ultrafast -crf 15 {QUOTE}{AFX_STREAM_PATH}\video.mp4{QUOTE}"
mirv_streams settings add ffmpeg tekno_ffmpeg_ultra_high "-c:v libx264 -pix_fmt yuv420p -preset ultrafast -crf 11 {QUOTE}{AFX_STREAM_PATH}\video.mp4{QUOTE}"
mirv_streams settings add ffmpeg tekno_ffmpeg_almost_lossless "-c:v libx264 -pix_fmt yuv420p -preset ultrafast -crf 1 {QUOTE}{AFX_STREAM_PATH}\video.mp4{QUOTE}"
mirv_streams settings add ffmpeg tekno_ffmpeg_lossless "-c:v libx264 -pix_fmt yuv420p -preset ultrafast -crf 0 {QUOTE}{AFX_STREAM_PATH}\video.mp4{QUOTE}"
mirv_streams settings add ffmpeg tekno_ffmpeg_prores "-c:v prores_ks -profile:v 4 -qscale:v 0 -vendor ap10 -pix_fmt yuva444p10le -c:a pcm_s16le {QUOTE}{AFX_STREAM_PATH}\video.mov{QUOTE}"
mirv_streams settings add ffmpeg tekno_ffmpeg_utvideo "-c:v utvideo -vf format=yuv420p -preset ultrafast {QUOTE}{AFX_STREAM_PATH}\video.avi{QUOTE}" // https://github.com/umezawatakeshi/utvideo

// set up motion blur sampler
mirv_streams settings add sampler tekno_blur
mirv_streams settings edit tekno_blur method rectangle

// ------------------ aliases ------------------- //

// recording
alias rec "start"
alias start "exec hlae__settings; demo_resume; engine_no_focus_sleep 0; host_timescale 0; mirv_streams record start; alias rec end"
alias end "mirv_streams record end; engine_no_focus_sleep 50; host_timescale 1; host_framerate 0; demo_pause; alias rec start"

alias +speedup "demo_timescale 3"
alias -speedup "demo_timescale 1"

alias back "demo_gototick -400 relative"

// game
alias list_players "mirv_listentities isPlayer=1"
alias hide_player "echo mirv_streams edit game actionFilter addEx "handle=<handle>" "action=noDraw"

alias players_off "cl_foot_contact_shadows 0; mirv_streams edit game actionFilter addEx isPlayer=1 action=noDraw"
alias players_on "cl_foot_contact_shadows 1; mirv_streams edit game actionFilter clear"

alias toggle_players "toggle_players_off"
alias toggle_players_off "players_off; echo hiding players; alias toggle_players toggle_players_on"
alias toggle_players_on "players_on; echo showing players; alias toggle_players toggle_players_off"

alias fix_skybox "mat_suppress models/props/de_nuke/hr_nuke/nuke_skydome_001/nuke_skydome_001; mat_suppress models/props/de_dust/hr_dust/dust_skybox/sky_dust2"

alias toggle_skins "skins_off"
alias skins_off "cl_custom_material_override 0; echo disabled skins; alias skins skins_on"
alias skins_on "cl_custom_material_override 1; echo enabled skins;  alias skins skins_off"

alias toggle_flash "flash_off"
alias flash_off "mat_suppress effects/flashbang.vmt; mat_suppress effects/flashbang_white.vmt; echo hiding flashes; alias flash flash_on"
// alias flash_on" "mat_suppress effects/flashbang.vmt; mat_suppress effects/flashbang_white.vmt; echo showing flashes; alias flash flash_off"

alias toggle_smoke "smoke_off"
alias smoke_off "r_drawparticles 0; echo hiding smokes; alias toggle_smoke smoke_on"
alias smoke_on "r_drawparticles 1; echo showing smokes; alias toggle_smoke smoke_off"

// killfeed
alias killfeed_highlight "mirv_deathmsg localplayer xTrace; echo highlighting the current players kills"
alias killfeed_block "mirv_deathmsg filter add attackerMatch=!xTrace victimMatch=!xTrace block=1 lastRule=1; echo blocked other players kills in killfeed"
alias killfeed_old_icons "mirv_deathmsg filter add noscope=0 thrusmoke=0 attackerblind=0; echo blocked new icons"
alias killfeed_lifetime "mirv_deathmsg lifetimeMod 10; echo extended killfeed entries"
alias killfeed_reset "mirv_deathmsg filter clear; mirv_deathmsg lifeTime default; mirv_deathmsg localplayer default; echo reset killfeed"

// hud
alias toggle_radar "radar_off"
alias radar_off "cl_drawhud_force_radar -1; alias toggle_radar radar_on; echo now hiding radar"
alias radar_on "cl_drawhud_force_radar 0; alias toggle_radar radar_off; echo now showing radar"

alias toggle_chat "chat_off"
alias chat_off "mirv_cvar_hack cl_chatfilters 0; alias chat toggle_chat; echo now hiding chat"
alias chat_on "mirv_cvar_hack cl_chatfilters 1; alias chat toggle_chat; echo now showing chat"

// main help command
alias commands_recording "echo [recording]; echo rec - start/stop recording"
alias commands_game "echo [game]; echo toggle_players - toggle player visibility; echo fix_skybox - fix nuke & dust skyboxes; echo toggle_skins - toggle weapon skins; echo toggle_flash - toggle flashes; echo toggle_smoke - toggle smokes"
alias commands_killfeed "echo [killfeed]; echo killfeed_highlight - highlight the current players kills in killfeed; echo killfeed_block - only show the current players kills in killfeed; echo killfeed_old_icons - block new killfeed icons; echo killfeed_lifetime - extend killfeed duration; echo killfeed_reset - reset killfeed"
alias commands_hud "echo [hud]; echo toggle_radar - toggle radar; echo toggle_chat - toggle chat"
alias commands_helpers "echo [helpers]; echo list_players - list player ids"
alias commands "echo; commands_recording; echo; commands_game; echo; commands_killfeed; echo; commands_hud; echo; echo commands_helpers; echo; echo \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\; echo"

// --------------- general config --------------- //

// your movie config
exec movie

// DEMO FIX
demo_index 1

// hlae smoother demos
sv_cheats 1
mirv_snd_timescale 1
cl_clock_correction 0
mirv_fix playerAnimState 1

// spectator tools in mirv_pov
mirv_force_spectatortools 1

// block radio commands
snd_setmixer Dialog vol 0

// block pings
cl_player_ping_mute 2

// unhide commands
mirv_cvar_unhide_all

// fix nuke & dust 2 skyboxes

// misc
mp_display_kill_assists 0
cl_sanitize_muted_players 0
cl_drawhud_force_teamid_overhead -1

// ----------------- binds ------------------- //

bind o "rec"
bind KP_UPARROW "demo_togglepause"
bind KP_DOWNARROW "demo_pause"
bind KP_LEFTARROW "back"
bind KP_RIGHTARROW "+speedup"
unbind alt

// ----------------- main ------------------- //

echo
echo \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
echo
echo tekno hlae
echo type commands for a list of commands
echo
echo \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
echo